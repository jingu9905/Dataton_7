# í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì •ë¦¬
import streamlit as st  # Streamlit ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë ˆì„ì›Œí¬
import pandas as pd  # ë°ì´í„° ì²˜ë¦¬ ë° ë¶„ì„ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
import numpy as np  # ìˆ˜ì¹˜ ì—°ì‚° ë° ë°°ì—´ ê³„ì‚°ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
import time  # ì‹œê°„ ì œì–´ ë° ì§€ì—°ì„ ìœ„í•œ ê¸°ë³¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
import pickle  # ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ì €ì¥ ë° ë¡œë“œë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
import joblib  # ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ì €ì¥ ë° ë¡œë“œ (Pickleì˜ ëŒ€ì•ˆ)
import plotly.express as px  # ëŒ€í™”í˜• ë°ì´í„° ì‹œê°í™”ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
from streamlit_echarts import st_echarts  # Echarts ê¸°ë°˜ì˜ ë°ì´í„° ì‹œê°í™” ì§€ì›
import os  # ìš´ì˜ ì²´ì œ ì‘ì—… (íŒŒì¼ ê²½ë¡œ, ë””ë ‰í† ë¦¬ ì‘ì—… ë“±)
import base64  # ë°ì´í„° ì¸ì½”ë”© ë° ë””ì½”ë”© (íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± ë“±ì— ì‚¬ìš©)
import streamlit.components.v1 as components  # HTML/CSS/JSë¥¼ ì‚½ì…í•˜ì—¬ Streamlit í™•ì¥


# í˜ì´ì§€ ì„¤ì •
st.set_page_config(
    page_title="ë°ì´í„°í†¤ í”„ë¡œì íŠ¸",
    page_icon="âš¾",  # ì›í•˜ëŠ” ì•„ì´ì½˜
    layout="wide"
)

# ì‚¬ì´ë“œë°” ìƒë‹¨ì— ì œëª© ì¶”ê°€
with st.sidebar:
    st.markdown(
        """
        <style>
        [data-testid="stSidebar"]::before {
            content: "âš¾ 7ì¡° ë°ì´í„°í†¤ í”„ë¡œì íŠ¸";
            font-size: 20px;
            font-weight: bold;
            margin-left: 10px;
            margin-top: 10px;
            display: block;
            color: #333333;
        }
        </style>
        """,
        unsafe_allow_html=True,
    )

# í˜„ì¬ íŒŒì¼ì˜ ë””ë ‰í† ë¦¬ ê²½ë¡œ ì„¤ì •
base_dir = os.path.dirname(os.path.abspath(__file__))

# ëª¨ë¸ íŒŒì¼ ê²½ë¡œ ì„¤ì • (ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ê¸°ì¤€ìœ¼ë¡œ ë³€ê²½)
model_path = os.path.join(base_dir, "../rf_model.pkl")

 # ëª¨ë¸ ë¡œë“œ
    with open(model_path, "rb") as file:
        model = pickle.load(file)

# í•™ìŠµì— ì‚¬ìš©ëœ ëª¨ë“  feature í™•ì¸
all_features = model.feature_names_in_

# ì‚¬ìš©ìì—ê²Œ ì…ë ¥ë°›ì„ ì£¼ìš” ë³€ìˆ˜ì™€ ê¸°ë³¸ê°’ ì„¤ì •
important_features_defaults = {
    'ìŠ¹ë¥ ': 0.48,
    'ìŠ¹ë¦¬íšŸìˆ˜': 80.0,         # ì‹œì¦Œ ìŠ¹ë¦¬ í‰ê· 
    'ì„¸ì´ë¸Œ_íšŸìˆ˜': 29.0,      # ì‹œì¦Œ í‰ê·  ì„¸ì´ë¸Œ íšŸìˆ˜
    'ì´_ì‹¤ì ìˆ˜': 800.0,       # í‰ê·  ì‹¤ì 
    'í™ˆëŸ°íšŸìˆ˜': 180.0,        # ì‹œì¦Œ í‰ê·  í™ˆëŸ°
    '2ë£¨íƒ€íšŸìˆ˜': 300.0,       # ì‹œì¦Œ í‰ê·  2ë£¨íƒ€
    'íƒ€ì_ì‚¼ì§„íšŸìˆ˜': 1300.0   # íƒ€ì ì‚¼ì§„ í‰ê· 
}

# Streamlit UI
st.title("ğŸ‚ì˜¬í•´ì—” ê°€ì„ì•¼êµ¬ ê°€ëŠ¥í• ê¹Œ? : í¬ìŠ¤íŠ¸ì‹œì¦Œ ì§„ì¶œ ì—¬ë¶€ ì˜ˆì¸¡ğŸ‚")

# ì—´ ë‚˜ëˆ„ê¸°: ì™¼ìª½ê³¼ ì˜¤ë¥¸ìª½
left_col, right_col = st.columns(2)

# ì™¼ìª½ ì—´: ì˜ˆì¸¡ ê¸°ëŠ¥
with left_col:
    st.header("[í¬ìŠ¤íŠ¸ì‹œì¦Œ ì§„ì¶œ ì—¬ë¶€ ì˜ˆì¸¡]")
    inputs = {}
    for feature, default_value in important_features_defaults.items():
        inputs[feature] = st.number_input(f"{feature} ì…ë ¥", min_value=0.0, value=default_value)

    if st.button("ğŸ¤–ë°”ë©! ì˜ˆì¸¡í•´ì¤˜!"):
        try:
            # ëª¨ë“  featureë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”
            input_data = {feature: 0 for feature in all_features}

            # ì…ë ¥ë°›ì€ featureë§Œ ì‚¬ìš©ì ì…ë ¥ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            for feature, value in important_features_defaults.items():
                input_data[feature] = inputs[feature]

            # DataFrame ìƒì„±
            input_data_df = pd.DataFrame([input_data])

            # ë™ì  ë¬¸êµ¬ ì»¨í…Œì´ë„ˆ ìƒì„±
            progress_message = st.empty()

            # ë¡œë”© ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            for i in range(5):
                message = f"ğŸ¤–ë°”ë©ì´ ê°€ì„ì•¼êµ¬ë¥¼ í•  ìˆ˜ ìˆì„ì§€ ì˜ˆì¸¡ ì¤‘ì´ì—ìš”{'.' * (i + 1)}"
                progress_message.text(message)  # ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                time.sleep(1)  # 1ì´ˆ ëŒ€ê¸°

            # ì˜ˆì¸¡ ìˆ˜í–‰
            prediction = model.predict(input_data_df)
            prob = model.predict_proba(input_data_df)[0][1]

            # ë¡œë”© ë©”ì‹œì§€ ì™„ë£Œ ë¬¸êµ¬ë¡œ êµì²´
            progress_message.text("ğŸ¤–ë°”ë©ì´ ê°€ì„ì•¼êµ¬ë¥¼ í•  ìˆ˜ ìˆì„ì§€ ì˜ˆì¸¡í–ˆì–´ìš”!")

            # ê²°ê³¼ ì¶œë ¥
            result = "ğŸ™†ğŸ»â€â™€ï¸ì˜¬í•´ì—” í¬ìŠ¤íŠ¸ ì‹œì¦Œ ì§„ì¶œ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤!ğŸ™†ğŸ»â€â™‚ï¸" if prediction[0] == 1 else "ğŸ¤¦ğŸ»â€â™€ï¸ì˜¬í•´ì—” í¬ìŠ¤íŠ¸ ì‹œì¦Œ ì§„ì¶œ ê°€ëŠ¥ì„±ì´ ë‚®ìŠµë‹ˆë‹¤ğŸ¤¦ğŸ»â€â™‚ï¸"
            st.subheader(f"ë°”ë©ì´ ì˜ˆì¸¡í•œ ê²°ê³¼ëŠ”?: {result}")
            st.write(f"ë°”ë©ì´ ì˜ˆì¸¡í•œ ì§„ì¶œ í™•ë¥ ì€ {prob*100:.2f}% ì…ë‹ˆë‹¤!")

            # ê°„ë‹¨í•œ ë¶„ì„
            st.subheader("ğŸ“œë°”ë©ì´ ì•Œë ¤ì£¼ëŠ” í¬ìŠ¤íŠ¸ ì‹œì¦Œ ì§„ì¶œì´ ì–´ë ¤ìš´ ì´ìœ  ê°„ë‹¨ë¶„ì„!ğŸ“œ:")
            if input_data['ìŠ¹ë¥ '] < 0.5:
                st.write("âš ï¸ ìŠ¹ë¥ ì´ ë‚®ìŠµë‹ˆë‹¤. ë” ë§ì€ ìŠ¹ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.")
            if input_data['ì´_ì‹¤ì ìˆ˜'] > 700:
                st.write("âš ï¸ ì´ ì‹¤ì ìˆ˜ê°€ ë§ìŠµë‹ˆë‹¤. íˆ¬ìˆ˜ë ¥ ê°•í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.")
            if input_data['ì„¸ì´ë¸Œ_íšŸìˆ˜'] < 30:
                st.write("âš ï¸ ì„¸ì´ë¸Œ íšŸìˆ˜ê°€ ì ìŠµë‹ˆë‹¤. ë§ˆë¬´ë¦¬ íˆ¬ìˆ˜ì˜ ì•ˆì •ì´ í•„ìš”í•©ë‹ˆë‹¤.")
        except Exception as e:
            st.error(f"ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")



# ì˜¤ë¥¸ìª½ ì—´: ì„¤ëª…
with right_col:
    st.header("[ëª¨ë¸ ì„¤ëª…]")
    st.markdown("""
    ### ğŸ† **í¬ìŠ¤íŠ¸ì‹œì¦Œ ì§„ì¶œ ì˜ˆì¸¡ ëª¨ë¸ì´ë€?**
    ì´ ëª¨ë¸ì€ íŒ€ì˜ ì£¼ìš” ê²½ê¸° ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í¬ìŠ¤íŠ¸ì‹œì¦Œ ì§„ì¶œ ê°€ëŠ¥ì„±ì„ ì˜ˆì¸¡í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì„ êµ¬í˜„í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. 
    ìŠ¹ë¥ , ìŠ¹ë¦¬ íšŸìˆ˜, í™ˆëŸ°, ì„¸ì´ë¸Œ ë“± ë‹¤ì–‘í•œ ì£¼ìš” ì§€í‘œë¥¼ ì…ë ¥í•˜ë©´ ê²°ê³¼ë¥¼ ì§ê´€ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    ### ğŸ“Š **ì‚¬ìš©ëœ ì£¼ìš” ë°ì´í„°ì™€ ì§€í‘œ**
    - **ìŠ¹ë¥ :** íŒ€ì˜ ìŠ¹ë¦¬ ë¹„ìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ê²½ê¸° ì„±ê³¼ë¥¼ í‰ê°€í•˜ëŠ” í•µì‹¬ ì§€í‘œì…ë‹ˆë‹¤.
    - **í™ˆëŸ° ìˆ˜:** ê³µê²©ë ¥ì„ ìƒì§•í•˜ëŠ” ëŒ€í‘œì ì¸ ì§€í‘œì…ë‹ˆë‹¤.
    - **ì„¸ì´ë¸Œ íšŸìˆ˜:** ë§ˆë¬´ë¦¬ íˆ¬ìˆ˜ì˜ ê²½ê¸° ë§ˆê° ëŠ¥ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.
    - **íƒ€ì ìƒì‚°ë ¥ ì§€ìˆ˜:** ì„ ìˆ˜ë“¤ì˜ ì „ì²´ì ì¸ ë“ì  ê¸°ì—¬ë„ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.  
    ì´ ì™¸ì—ë„ ë‹¤ì–‘í•œ íŒ€ ì„±ê³¼ ë°ì´í„°ë¥¼ ëª¨ë¸ì— í™œìš©í•˜ì—¬ ì •í™•ë„ë¥¼ ë†’ì˜€ìŠµë‹ˆë‹¤.

    ### ğŸ¤– **ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì˜ ê°•ì **
    - **ì˜ˆì¸¡ ì •í™•ë„:** 70% ì´ìƒì˜ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í›ˆë ¨ë˜ì–´ ë†’ì€ ì‹ ë¢°ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.
    - **íŒ€ ë§ì¶¤ ë¶„ì„:** ì…ë ¥ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŒ€ì˜ ê°•ì ê³¼ ì•½ì ì„ í•œëˆˆì— ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - **ë¹ ë¥¸ ê²°ê³¼ ë„ì¶œ:** ì‹¤ì‹œê°„ìœ¼ë¡œ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ ê²½ê¸° ì „ëµì— ì¦‰ì‹œ ë°˜ì˜ ê°€ëŠ¥í•©ë‹ˆë‹¤.

    ### ğŸš€ **ë¯¸ë˜ í™œìš© ê°€ëŠ¥ì„±**
    ì´ ëª¨ë¸ì€ í–¥í›„ íŒ€ì˜ ì—°ê°„ ì„±ì ì„ ì˜ˆì¸¡í•˜ê±°ë‚˜ íŠ¹ì • ì„ ìˆ˜ì˜ ì„±ê³¼ë¥¼ ì¶”ì í•˜ëŠ” ë° í™•ì¥ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
    MLB êµ¬ë‹¨ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ ìŠ¤í¬ì¸  íŒ€ì—ì„œë„ í™œìš© ê°€ëŠ¥í•œ ë°ì´í„° ê¸°ë°˜ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.
    """)
